# VibeFM 要件定義書

## 1. プロジェクト概要
VibeFMは、ユーザーの気分や感情に基づいて音楽をレコメンドするWebサービスです。ユーザーが入力した感情や状況に合わせて、Spotifyの曲やプレイリストを提案します。Dockerコンテナ化された環境で開発・運用を行い、Cloud Run上でスケーラブルに動作します。

## 2. 主要機能

### 2.1 ユーザー入力機能
- テキスト入力フィールドで気分や状況を自由に入力可能
- 入力例：
  - 「雨の日に聴きたい」
  - 「自分を奮い立たせたい」
  - 「リラックスしたい」
  - 「運動中に聴きたい」
  - 「勉強に集中したい」

### 2.2 レコメンド機能
- ユーザー入力から3秒以内に結果を表示
- 初期フェーズでは、以下のような固定のマッピングで即時レスポンスを実現：
  - 雨関連キーワード → Lo-Fi雨音プレイリスト
  - モチベーション関連キーワード → アップテンポな曲
  - リラックス関連キーワード → アンビエント音楽
  - 運動関連キーワード → エクササイズプレイリスト
  - 集中関連キーワード → 集中用BGM

### 2.3 表示機能
- レコメンドされた曲/プレイリストの表示
  - アルバムアート
  - 曲名/プレイリスト名
  - アーティスト名
  - 30秒プレビュー再生機能（Spotify Web Playback SDK使用）

## 3. 技術要件

### 3.1 フロントエンド
- Next.js 14（App Router）
- TypeScript
- Tailwind CSS
- Spotify Web Playback SDK
- Dockerコンテナ化対応

### 3.2 バックエンド
- Next.js API Routes
- Spotify Web API
- Dockerコンテナ化対応
- Cloud Runデプロイ対応

### 3.3 インフラストラクチャ
- Docker
- Docker Compose（開発環境）
- Google Cloud Platform
  - Cloud Run
  - Cloud Build
  - Cloud Storage
  - Secret Manager

### 3.4 デザイン要件
- Lo-Fiで温かみのある雰囲気
- カラーパレット：
  - メインカラー：#FF6B6B（温かみのある赤）
  - アクセントカラー：#4ECDC4（落ち着いたターコイズ）
  - 背景色：#F7F7F7（柔らかい白）
  - テキストカラー：#2D3436（深みのあるグレー）
- フォント：
  - 見出し：Noto Sans JP
  - 本文：M PLUS 1p
- アニメーション：
  - 入力時のスムーズなトランジション
  - 結果表示時のフェードイン効果

## 4. 非機能要件

### 4.1 パフォーマンス
- ページロード時間：2秒以内
- レコメンド結果表示：3秒以内
- モバイル対応（レスポンシブデザイン）
- コンテナ起動時間：30秒以内
- スケーリング対応：トラフィックに応じた自動スケーリング

### 4.2 セキュリティ
- Spotify認証の安全な実装
- 環境変数による機密情報の管理
- コンテナセキュリティ対策
- ネットワークセキュリティ対策
- 定期的なセキュリティアップデート

### 4.3 ユーザビリティ
- 直感的なUI/UX
- エラー時の適切なフィードバック
- ローディング状態の表示

## 5. 将来的な拡張機能
- ユーザーアカウント機能
- お気に入り保存機能
- より高度なレコメンドアルゴリズム
- ソーシャル機能（シェア、いいね等）
- カスタムプレイリスト作成機能

## 6. 開発フェーズ

### フェーズ1（MVP）
- 基本的なUI実装
- 固定マッピングによる即時レコメンド
- Spotify認証の実装

### フェーズ2
- より高度なレコメンドロジック
- ユーザーアカウント機能
- お気に入り機能

### フェーズ3
- ソーシャル機能
- カスタムプレイリスト作成
- パフォーマンス最適化 

## 7. 開発フロー

### 7.1 開発環境
- Docker Composeを使用した開発環境の構築
- 以下のコンテナを構成：
  - Next.jsアプリケーション
  - Node.js開発環境
  - ホットリロード対応
- 環境変数の管理（.envファイル）

### 7.2 開発プロセス
- 機能開発はfeatureブランチで実施
- プルリクエストベースのコードレビュー
- 自動テストの実行（CI/CD）
- ステージング環境での動作確認

## 8. 本番環境

### 8.1 インフラストラクチャ
- Google Cloud Platform（GCP）を採用
- Cloud Runでのコンテナ実行
- Cloud Buildによる自動デプロイ
- Cloud Storage（静的アセット用）

### 8.2 デプロイメント
- Dockerイメージのビルドとプッシュ
- Cloud Runへの自動デプロイ
- 環境変数の管理（Secret Manager）
- スケーリング設定
  - 最小インスタンス数：1
  - 最大インスタンス数：10
  - メモリ割り当て：1GB
  - CPU割り当て：1コア

### 8.3 監視とロギング
- Cloud Monitoringによるパフォーマンス監視
- Cloud Loggingによるログ管理
- エラー通知の設定
- アクセス解析の実装

## 9. セキュリティ要件の追加

### 9.1 コンテナセキュリティ
- コンテナイメージの脆弱性スキャン
- 最小権限の原則に基づく実行
- 定期的なセキュリティアップデート

### 9.2 ネットワークセキュリティ
- HTTPS通信の強制
- WAFの設定
- DDoS対策
- レート制限の実装 